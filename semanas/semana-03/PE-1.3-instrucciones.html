<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>PE-1.3 Laboratorio: WAL y Checkpoints</title>
</head>
<body>
<p>Esta actividad práctica te permitirá <strong>observar el logging en MySQL</strong> usando el <strong>Sistema de Pagos QR "¡ahorita!" del Banco de Loja</strong>. Te enfocarás en <em>verificar que el binary log esté activo</em>, <em>ejecutar transacciones de pagos</em>, y <em>ver los logs generados</em>.</p>

<p><strong>¿Qué realizarás?</strong></p>
<div class="_tableContainer_1rjym_1">
    <div class="group _tableWrapper_1rjym_13 flex w-fit flex-col-reverse">
        <table class="w-fit min-w-(--thread-content-width)" style="border-collapse: collapse; width: 100%;" border="1">
            <thead>
                <tr>
                    <th style="width: 26%;">Actividad</th>
                    <th style="width: 49%;">Instrucciones</th>
                    <th style="width: 25%;">Entregable</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1) Verificar binary log</td>
                    <td>Ejecuta: <code>SHOW VARIABLES LIKE 'log_bin';</code> para verificar si está activo.</td>
                    <td>Captura mostrando resultado.</td>
                </tr>
                <tr>
                    <td>2) Ejecutar transacciones de pago</td>
                    <td>Usando la BD <code>pagos_qr_sistema</code> y <strong>tu cuenta asignada (ID entre 101-127)</strong>, ejecuta 3 transacciones de pago QR en diferentes comercios.</td>
                    <td>Script SQL ejecutado con capturas.</td>
                </tr>
                <tr>
                    <td>3) Ver logs</td>
                    <td>Ejecuta: <code>SHOW BINARY LOGS;</code> para ver los archivos de log generados.</td>
                    <td>Captura de lista de logs.</td>
                </tr>
                <tr>
                    <td>4) Explicar</td>
                    <td>En 2-3 líneas: ¿Para qué sirve el binary log en el Sistema de Pagos QR?</td>
                    <td>Explicación breve contextualizada.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<p><strong>Comandos a ejecutar en MySQL:</strong></p>

<p><strong>IMPORTANTE:</strong> Reemplaza <code>XXX</code> con tu ID de cuenta asignado (entre 101 y 127).</p>

<pre>
-- 1. Verificar binary log
SHOW VARIABLES LIKE 'log_bin';

-- 2. Usar la base de datos del Sistema de Pagos QR
USE pagos_qr_sistema;

-- 3. Verificar tu saldo inicial
-- IMPORTANTE: Reemplaza XXX con tu ID de cuenta
SELECT id, titular, saldo, limite_diario
FROM Cuentas
WHERE id = XXX;

-- 4. Transacción 1: Pago en Cafetería UIDE ($2.50)
START TRANSACTION;
UPDATE Cuentas SET saldo = saldo - 2.50 WHERE id = XXX;  -- Tu cuenta
UPDATE Cuentas SET saldo = saldo + 2.50 WHERE id = 202;  -- Cafetería UIDE
INSERT INTO Pagos_QR (payment_id, cliente_id, comercio_id, monto, descripcion, estado, metodo_pago)
VALUES (CONCAT('PAY_PE13_', XXX, '_001'), XXX, 2, 2.50, 'PE 1.3 - Desayuno', 'CONFIRMADO', 'QR_AHORITA');
COMMIT;

-- 5. Transacción 2: Pago de transporte urbano ($0.35)
START TRANSACTION;
UPDATE Cuentas SET saldo = saldo - 0.35 WHERE id = XXX;  -- Tu cuenta
UPDATE Cuentas SET saldo = saldo + 0.35 WHERE id = 208;  -- Transporte
INSERT INTO Pagos_QR (payment_id, cliente_id, comercio_id, monto, descripcion, estado, metodo_pago)
VALUES (CONCAT('PAY_PE13_', XXX, '_002'), XXX, 8, 0.35, 'PE 1.3 - Pasaje', 'CONFIRMADO', 'QR_AHORITA');
COMMIT;

-- 6. Transacción 3: Pago en minimarket ($1.50)
START TRANSACTION;
UPDATE Cuentas SET saldo = saldo - 1.50 WHERE id = XXX;  -- Tu cuenta
UPDATE Cuentas SET saldo = saldo + 1.50 WHERE id = 206;  -- Minimarket
INSERT INTO Pagos_QR (payment_id, cliente_id, comercio_id, monto, descripcion, estado, metodo_pago)
VALUES (CONCAT('PAY_PE13_', XXX, '_003'), XXX, 6, 1.50, 'PE 1.3 - Snacks', 'CONFIRMADO', 'QR_AHORITA');
COMMIT;

-- 7. Ver lista de binary logs
SHOW BINARY LOGS;

-- 8. Ver contenido del último log (opcional)
SHOW BINLOG EVENTS LIMIT 10;

-- 9. Verificar tu saldo final
SELECT id, titular, saldo
FROM Cuentas
WHERE id = XXX;

-- 10. Ver tus transacciones
SELECT payment_id, monto, descripcion, estado, fecha
FROM Pagos_QR
WHERE payment_id LIKE CONCAT('PAY_PE13_', XXX, '%')
ORDER BY fecha;
</pre>

<p><strong>¿Para qué sirve el binary log en el Sistema de Pagos QR?</strong></p>
<ul>
    <li><strong>Recuperación</strong>: Permite restaurar transacciones de pago después de un fallo del servidor</li>
    <li><strong>Replicación</strong>: Sincroniza datos entre sucursales del Banco de Loja</li>
    <li><strong>Auditoría</strong>: Registra todas las transacciones QR para cumplimiento normativo bancario</li>
</ul>

<p><strong>Especificaciones técnicas de entrega</strong></p>
<div class="_tableContainer_1rjym_1">
    <div class="group _tableWrapper_1rjym_13 flex w-fit flex-col-reverse">
        <table class="w-fit min-w-(--thread-content-width)" style="border-collapse: collapse; width: 100%;" border="1">
            <thead>
                <tr>
                    <th style="width: 25%;">Aspecto</th>
                    <th style="width: 75%;">Especificación requerida</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Formato de entrega</strong></td>
                    <td>PDF con capturas y explicaciones. Nomenclatura: PE-1.3_ApellidoNombre_WAL.pdf</td>
                </tr>
                <tr>
                    <td><strong>Capturas</strong></td>
                    <td>Claras y legibles mostrando: verificación de log_bin, transacciones ejecutadas, lista de binary logs.</td>
                </tr>
                <tr>
                    <td><strong>Explicación</strong></td>
                    <td>2-3 líneas explicando para qué sirve el binary log en MySQL.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<p><strong>Información importante</strong></p>
<ul>
    <li><strong>Modalidad:</strong> Práctica presencial (lab) — <strong>2.25 pts</strong>.</li>
    <li><strong>Duración:</strong> 90 minutos.</li>
    <li><strong>Entrega:</strong> Documento al final de la clase.</li>
</ul>

<p><strong>Recursos de apoyo:</strong></p>
<ul>
    <li>Documentación MySQL Binary Log: https://dev.mysql.com/doc/refman/8.0/en/binary-log.html</li>
    <li>Compendio Semana 3</li>
</ul>

<p><strong>Nota de compatibilidad:</strong></p>
<div style="background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 15px; margin: 15px 0;">
    <p style="margin: 0;"><strong>✓ Comandos compatibles con MySQL 8.0 y MySQL 8.4</strong></p>
    <p style="margin: 5px 0 0 0; font-size: 0.95rem;">
        Todos los comandos SQL de esta práctica (<code>SHOW VARIABLES LIKE 'log_bin'</code>,
        <code>SHOW BINARY LOGS</code>, <code>SHOW BINLOG EVENTS</code>, <code>START TRANSACTION</code>,
        <code>COMMIT</code>, <code>UPDATE</code>, <code>INSERT</code>) son completamente compatibles
        con MySQL 8.0.x y MySQL 8.4.x (LTS). Verificado con documentación oficial MySQL 2025.
    </p>
</div>

<p>Si tienes dudas durante la actividad, levanta la mano para recibir asistencia del docente.</p>
</body>
</html>
