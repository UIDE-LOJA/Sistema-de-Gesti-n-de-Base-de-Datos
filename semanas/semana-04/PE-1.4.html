<p>Esta actividad práctica te permitirá aplicar los <strong>conceptos de optimización de consultas SQL</strong> mediante el análisis de planes de ejecución. Te enfocarás en <em>ejecutar EXPLAIN/ANALYZE</em>, <em>comparar rendimiento con y sin índices</em>, y <em>optimizar consultas</em> basándote en métricas reales.</p>

<p><strong>¿Qué realizarás?</strong></p>
<div class="_tableContainer_1rjym_1">
    <div class="group _tableWrapper_1rjym_13 flex w-fit flex-col-reverse">
        <table class="w-fit min-w-(--thread-content-width)" style="border-collapse: collapse; width: 100%;" border="1">
            <thead>
                <tr>
                    <th style="width: 23.5%;" data-col-size="sm">Actividad</th>
                    <th style="width: 47%;" data-col-size="xl">Instrucciones específicas</th>
                    <th style="width: 29.5%;" data-col-size="md">Entregable</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td data-col-size="sm">Preparación individual</td>
                    <td data-col-size="xl">Revisa presentación Semana 4 sobre optimización, índices y planes de ejecución. Usa la base de datos pagos_qr_sistema creada en Semana 2.</td>
                    <td data-col-size="md">Base de datos pagos_qr_sistema lista con datos.</td>
                </tr>
                <tr>
                    <td data-col-size="sm">Consulta 1: SELECT simple</td>
                    <td data-col-size="xl">Ejecuta EXPLAIN en consulta SELECT sobre Pagos_QR con filtro WHERE. Registra: type, key, rows, filtered, Extra. Crea índice y vuelve a ejecutar.</td>
                    <td data-col-size="md">Comparativa EXPLAIN antes/después del índice.</td>
                </tr>
                <tr>
                    <td data-col-size="sm">Consulta 2: JOIN</td>
                    <td data-col-size="xl">Ejecuta EXPLAIN en consulta con JOIN entre Pagos_QR, Cuentas y Comercios. Analiza type de cada tabla y uso de índices. Optimiza si es necesario.</td>
                    <td data-col-size="md">Análisis de plan de ejecución de JOIN.</td>
                </tr>
                <tr>
                    <td data-col-size="sm">Consulta 3: Agregación</td>
                    <td data-col-size="xl">Ejecuta EXPLAIN en consulta con GROUP BY sobre Pagos_QR (ej: suma de montos por comercio). Identifica "Using temporary" o "Using filesort" y optimiza.</td>
                    <td data-col-size="md">Optimización de consulta agregada.</td>
                </tr>
                <tr>
                    <td data-col-size="sm">Análisis comparativo</td>
                    <td data-col-size="xl">Crea tabla comparativa con métricas: type, key, rows, filtered, Extra para las 3 consultas antes/después de optimizar.</td>
                    <td data-col-size="md">Tabla comparativa completa.</td>
                </tr>
                <tr>
                    <td data-col-size="sm">Entrega final</td>
                    <td data-col-size="xl">Compila PDF con consultas SQL, salidas de EXPLAIN ANALYZE, tabla comparativa y breve análisis (máximo 200 palabras) sobre optimizaciones aplicadas.</td>
                    <td data-col-size="md">PDF completo con evidencias.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<p><strong>Ejemplo de análisis con EXPLAIN ANALYZE en MySQL 8.0:</strong></p>
<pre>
-- Consulta sin índice
EXPLAIN SELECT payment_id, monto, estado
FROM Pagos_QR
WHERE cliente_id = 1001 AND fecha >= NOW() - INTERVAL 7 DAY;

Resultado (sin índice):
+----+-------+----------+------+---------------------+
| id | type  | key      | rows | filtered | Extra   |
+----+-------+----------+------+---------------------+
|  1 | ALL   | NULL     | 5000 |    10.00 | Using where |
+----+-------+----------+------+---------------------+
Rows examined: 5000

-- Crear índice compuesto
CREATE INDEX idx_cliente_fecha ON Pagos_QR(cliente_id, fecha);

-- Consulta con índice
EXPLAIN SELECT payment_id, monto, estado
FROM Pagos_QR
WHERE cliente_id = 1001 AND fecha >= NOW() - INTERVAL 7 DAY;

Resultado (con índice):
+----+-------+------------------+------+----------+-------------+
| id | type  | key              | rows | filtered | Extra       |
+----+-------+------------------+------+----------+-------------+
|  1 | range | idx_cliente_fecha|   35 |   100.00 | Using index condition |
+----+-------+------------------+------+----------+-------------+
Rows examined: 35

Mejora: type cambió de ALL a range, rows de 5000 a 35 (142x menos filas)
</pre>

<p><strong>Métricas clave a analizar en MySQL 8.0:</strong></p>
<ul>
    <li><strong>type:</strong> Tipo de acceso (ALL, index, range, ref, eq_ref, const)</li>
    <li><strong>key:</strong> Índice utilizado (NULL si no usa índice)</li>
    <li><strong>rows:</strong> Filas estimadas a examinar</li>
    <li><strong>filtered:</strong> Porcentaje de filas que pasan el filtro WHERE</li>
    <li><strong>Extra:</strong> Información adicional (Using where, Using index, Using temporary, Using filesort)</li>
    <li><strong>EXPLAIN ANALYZE (8.0.18+):</strong> Incluye tiempo de ejecución real en formato TREE</li>
</ul>

<p><strong>Información importante</strong></p>
<ul>
    <li><p><strong>Modalidad:</strong> Laboratorio individual — <strong>2.25 pts</strong>.</p></li>
    <li><p><strong>Duración:</strong> 90 minutos.</p></li>
    <li><p><strong>Entrega:</strong> PDF con consultas, análisis y métricas al final de la clase.</p></li>
    <li><p><strong>Formato:</strong> PE-1.4_ApellidoNombre_ExplainAnalyze.pdf</p></li>
</ul>

<p>Si tienes dudas durante la actividad, levanta la mano para recibir asistencia del docente.</p>
